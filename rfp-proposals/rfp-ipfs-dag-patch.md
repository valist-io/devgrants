# RFP Proposal: `IPFS DAG Diffing and Patching`

**Name of Project:** `IPFS DAG Diff & Patch`

**Link to RFP:** https://github.com/filecoin-project/devgrants/blob/master/rfps/developer-tooling.md

**RFP Category:** `dev-tool`

**Proposer:** `@awantoch`

**Do you agree to open source all work you do on behalf of this RFP and dual-license under MIT and APACHE2 licenses?:** Yes

# Project Description

Valist enables web3-native software distribution (binaries, game builds, node software, etc) by leveraging smart contract platforms and decentralized storage networks to coordinate access control and package name-spacing. It is modular and supports swapping out both the smart contract and storage layers. This means you can download executables/binaries without relying on centralized upstream servers, securely update applications and infrastructure, as well as multi-sig software releases. Currently, Valist uses EVM-based contracts for access control logic and package/namespace registration, and IPFS + Filecoin for storing all data.

Our objective with this proposal is to finish the necessary work required to get the `ipfs dag diff` and `ipfs dag patch` APIs functional and supporting the following use cases:

- Pinning 2 different files, calling the `ipfs dag patch` endpoint to generate a "diff" for what new blocks the client needs to fetch.

- Updating software such as game builds, node software, and other arbitrary binary applications.

- Efficient downloads of new data when storing a subset of a growing dataset

There is considerable demand for functionality like this from web3 game developers. Within the context of Kubo, this is a known issue that spans across multiple years of R&D, with .

This project builds upon these known issues in the Kubo repository:

- IPFS DAG Diff https://github.com/ipfs/kubo/issues/4801

- IPFS DAG Patch https://github.com/ipfs/kubo/issues/4782

The team will coordinate with the Protocol Labs & Kubo implementer team to ensure this works well for the broader IPFS ecosystem.

## Deliverables

- Upstream contribution to the `kubo` repository to include the `ipfs dag diff` endpoint.

- Upstream contribution to the `kubo` repository to include the `ipfs dag patch` endpoint.

## Development Roadmap

### 1.) IPFS DAG Diff API

This deliverable will focus on a prerequisite API necessary for the system functionality, `ipfs dag diff`.

This will build upon the current work and discussion around the following GitHub issue: https://github.com/ipfs/kubo/pull/8711

For reference, the [current state](https://github.com/ipfs/kubo/pull/8711#issuecomment-1267277062) is:

>2022-10-04 Kubo standup conversation: this requires deeper thought because it has impact on other commands. When we pick this up, it will be good to engage with it during the IPLD community call.

This API endpoint will take two CIDs and create a "diff" of the DAG blocks between them. This enables an IPFS node to return a response that can be used to pull in only the necessary blocks.

If an IPFS node has CID_A, and needs CID_B, the client can call something like  `ipfs dag diff CID_A CID_B`, and receive the diff between the two CIDs.

This diff can be used in conjunction with the IPFS Patch command to actually perform the operations necessary for pulling the new blocks and creating a final CID with the desired result.

**Team:**

* Alec Wantoch - primary development
* Zachary Pelkey - primary development

**Milestone budget:** $30,000

**Timeline:** ~30-90 days

### 2.) IPFS DAG Patch API

This deliverable will focus on the `ipfs dag patch` API which will support accepting a diff generated by the `ipfs dag diff` command in the previous deliverable, and performing the necessary operations to pull the necessary blocks and create the final CID.

This builds upon the following GitHub issue: https://github.com/ipfs/kubo/issues/4782

The format for the request/response of this endpoint will leverage [JSON Patch](https://jsonpatch.com/) and the latest spec for [IPLD Patch](https://ipld.io/specs/patch/), [as suggested](https://github.com/ipfs/kubo/issues/4782#issuecomment-370996430) by [Stebalien](https://github.com/Stebalien) from the PL team.

**Team:**

* Alec Wantoch - primary development
* Zachary Pelkey - primary development

**Milestone budget:** $30,000

**Timeline:** ~30-90 days

## Total Budget Requested

Sum up the total requested budget across all milestones, and include that figure here. Ensure that it does not exceed the total funding limit on the RFP.

**Total:** $60,000

## Maintenance and Upgrade Plans

Our team relies on these protocols for our product's development and functionality, and will continue to maintain these integrations for the long-term as it is a core offering of our solution.

# Team

## Contact Info

## Team Members

- Alec Wantoch
  - Email: alec@valist.io
  - Github: https://github.com/awantoch

- Zachary Pelkey
  - Email: zach@valist.io
  - Github: https://github.com/jiyuu-jin

## Team Member LinkedIn Profiles

- [Alec's LinkedIn profile](https://www.linkedin.com/in/awantoch/)

- [Zach's LinkedIn profile](https://www.linkedin.com/in/zachary-j-pelkey)

## Team Website

- [https://valist.io](https://valist.io)

- [https://app.valist.io](https://app.valist.io)

- [https://docs.valist.io](https://docs.valist.io)

## Relevant Experience

Our team has strong experience in web3 software engineering, protocol implementations, and information security. We have worked with Protocol Labs closely on several initiatives, and are a Protocol Labs portfolio company.

Each of our team members has prior experience in software engineering consulting, and have a long-term track record for contributing to open source.

Zach - Zach is a full-stack distributed systems engineer with a background in cloud computing, and blockchain core development. He has previously helped launch an enterprise blockchain platform, from core node software to user-facing wallets. He is an expert at rapidly prototyping applications and refining them to production-grade quality.

Alec - Alec is a full-stack software engineer with a background in information security, blockchain core development, and web-scale applications. He was previously the lead security engineer at Ethos prior to their acquisition by Voyager, where he helped build one of the first non-custodial universal wallet and blockchain API platforms.

The Valist organization is building on top of these protocols, and will continue maintaining our integrations and contributing to the protocols themselves.

## Team code repositories

- [Valist Repo](https://github.com/valist-io/valist-js)
- [Example Valist projects](https://github.com/valist-io/example-projects)
- [Ethereum light client](https://github.com/valist-io/leo)
- [Golang meta transaction library](https://github.com/valist-io/gasless)

# Additional Information

## Benefits to the IPFS ecosystem

- Diffing and patching is a very commonly requested feature among game developers due to the size of builds and updates. This will position IPFS in a way that makes it a viable solution for web3 game developers, as well as any developers looking for such functionality.

- By having an official implementation for this logic, pinning services and other IPFS providers can integrate this functionality in various ways, enriching the ecosystem as a whole, while providing new opportunities for gaming-focused IPFS providers.

## Benefits to the Filecoin ecosystem

- Software fits the exact type of data that the mission of Filecoin serves. Having useful data on Filecoin is essential to its future success, and the more software that is released through Valist, the more we can migrate away from centralized data stores, until eventually everything can stay web3-native from source code to built applications.

- Creating a retrieval market for data that is stored on Filecoin.

- Creating a discovery mechanism for finding software that's stored on Filecoin.

- Creating an easy, effective way for developers to use Filecoin in their daily workflows.
